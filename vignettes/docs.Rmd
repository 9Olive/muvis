---
title: "Questools Documentation"
subtitle: "Questionnarie Tools"
author: "statCompTeam@bAIo-lab"
copyright: "statCompTeam@bAIo-lab"
output:
  packagedocs::package_docs:
    toc: true
    toc_collapse: false
redirect: http://bAIo-lab.github.io/Questools
vignette: |
  %\VignetteIndexEntry{Questools Documentation}
  %\VignetteEngine{packagedocs::redirect}
navpills: |
  <li class="active"><a href='index.html'>Docs</a></li>
  <li><a href='rd.html'>Package Ref</a></li>
  <li><a href='https://github.com/bAIo-lab/Questools'>Github <i class='fa fa-github'></i></a></li>
---

```{r global_options, include=FALSE}
# R output pre blocks are styled by default to indicate output
knitr::opts_chunk$set(comment = NA)

# shorthand for rd_link() - see ?packagedocs::rd_link for more information
rdl <- function(x) packagedocs::rd_link(deparse(substitute(x)))
```

# Questools

Questools is a visualization and analysis toolkit for Questionnaire datasets.  To use this package, you 
will need the R statistical computing environment (version 3.0 or later).
```{r echo=FALSE}
library("jpeg")
jj <- readJPEG("./figure/ques.jpeg",native=TRUE)
graphics::plot(0:1,0:1,type="n",ann=FALSE,axes=FALSE)
rasterImage(jj,0,0,1,1)
```

## Installation and import
Questools can be installed through github:
```{r package, echo=TRUE, message=FALSE, warning=FALSE, eval=FALSE}
devtools::install_github("bAIo-lab/Questools")
library(Questools)
```

```{r package_real, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
devtools::install_github("bAIo-lab/Questools", dependencies=F)
library(Questools)
```

```{r include=FALSE}
library(dplyr)
library(kableExtra)
```

## Dateset
We'll use a health Questionnaire dataset to work with Questools. The dataset contains 291 variables, including 36 continuous (i.e., laboratory measurements), and 255 categorical variables (i.e., questions) having no missing data.
```{r dataset}
data <- read.csv("../../data.csv")
kableExtra::kable(head(data)) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```


## dim.reduce
Use `dim.reduce` to visualize the continuous variables in 2 dimensions with tsne. 
```{r dim, echo=TRUE, message=FALSE, warning=FALSE, eval=FALSE}
dim.reduce(data[,1:36], method = "tsne") -> plt
#plt
```

## ggm
Use `ggm` to construct a Gaussian Graphical Model with glasso and significance test method.
```{r ggm, echo=TRUE, message=FALSE, warning=FALSE}
ggm(data[,1:36], significance = 0.05, rho = 0.1, community = TRUE, methods = c("glasso", "sin")) -> g
g$network
g
```

## bn
Use `bn` to learn the structure of a Bayesian network fitting data with `si.hito.pc` as a Constraint-based algorithm, `mmhc` as a Hybrid algorithm, and `tabu` as a Score-based algorithm. Repeat the bootstrap sampling 100 times. (very time consuming)
```{r bn, echo=TRUE, message=FALSE, warning=FALSE}
bn(data = data[,1:36], C.alg = c("si.hiton.pc"), S.alg = c("mmhc", "tabu"), blacklist = data.frame(to = "BMI", to = "Age"), R = 10, community = FALSE, str.thresh = 0.9, dir.thresh = 0.5) -> n
n$network
n
```

## min.forest
Employ `min.forest` with BIC to construct a mixed-interaction model fitting the data.
```{r mf, echo=TRUE, message=FALSE, warning=FALSE}
min.forest(data, stat = "BIC", community = TRUE) -> mf
mf$network
mf
```

## div
Use `div` with 1000 times of permutation to find the most deferentially answered questions between people with answer "1" to the test 62 and people with answer "2" to the test 62. (Test 62 is about cardiovascular diseases.)
```{r div, echo=TRUE, message=FALSE, warning=FALSE}
g1 <- which(data$test62 == "1") 
g2 <- which(data$test62 == "2")
div(data[37:dim(data)[2]], g1, g2, permute = 1000) -> KL
KL$name <- row.names(KL)
KL <- KL %>% arrange(desc(KL))
kableExtra::kable(head(KL,n = 20)) %>%
  kable_styling() %>%
  scroll_box(width = "400px", height = "400px")
```


## div2
Use `div2` to find the most deferentially answered questions between people with relatively high BMI (relative to blood pressure) and people with high pressure (relative to BMI).

```{r div2, echo=TRUE, message=FALSE, warning=FALSE}
div2(data[37:dim(data)[2]], var1 = data$BMI, var2 = data$BloodPreS, permute = 0) -> KL
KL$name <- row.names(KL)
KL <- KL %>% arrange(desc(KL))
kableExtra::kable(head(KL, n = 20)) %>%
  kable_styling() %>%
  scroll_box(width = "300px", height = "400px")
```


## plot
Use `plot` for different visualizations. 
`levels` is set to 10 to capture categorical variables.

Histogram for test 10:
```{r plot1, echo=TRUE, message=FALSE, warning=FALSE}
plot(data, vars = c("test10"), levels = 10)
```

Density plot for BMI:pl
```{r plot2, echo=TRUE, message=FALSE, warning=FALSE}
plot(data, vars = c("BMI"), levels = 10)
```

Boxplot of BMI for different answers of test 1:
```{r plot3, echo=TRUE, message=FALSE, warning=FALSE}
plot(data, vars = c("test1", "BMI"), levels = 10)
```

Relative histogram of test 1 vs test 10:
```{r plot4, echo=TRUE, message=FALSE, warning=FALSE}
plot(data, vars = c("test1", "test10"), levels = 10)
```

Scatter plot of Weight vs BMI:
```{r plot5, echo=TRUE, message=FALSE, warning=FALSE}
plot(data, vars = c("Weight", "BMI"), levels = 10)
```

Pie chart of test 1:
```{r plot6, echo=TRUE, warning=FALSE}
plot(data, vars = c("test1"), levels = 10, pie = TRUE)
```



