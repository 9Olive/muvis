---
title: "muvis Documentation"
subtitle: "multivariate analysis and visualization"
author: "statCompTeam@bAIo-lab"
copyright: "statCompTeam@bAIo-lab"
output:
  packagedocs::package_docs:
    toc: true
    toc_collapse: false
redirect: http://bAIo-lab.github.io/muvis
vignette: |
  %\VignetteIndexEntry{muvis Documentation}
  %\VignetteEngine{packagedocs::redirect}
navpills: |
  <li class="active"><a href='index.html'>Docs</a></li>
  <li><a href='rd.html'>Package Ref</a></li>
  <li><a href='https://github.com/bAIo-lab/muvis'>Github <i class='fa fa-github'></i></a></li>
---

```{r global_options, include=FALSE}
# R output pre blocks are styled by default to indicate output
knitr::opts_chunk$set(comment = NA)

# shorthand for rd_link() - see ?packagedocs::rd_link for more information
rdl <- function(x) packagedocs::rd_link(deparse(substitute(x)))
```

# muvis

muvis is a visualization and analysis toolkit for multivariate datasets.  To use this package, you 
will need the R statistical computing environment (version 3.0 or later).

## Installation and import
muvis can be installed through github:
```{r package, echo=TRUE, message=FALSE, warning=FALSE, eval=FALSE}
devtools::install_github("bAIo-lab/muvis")
library(muvis)
```

```{r package_real, echo=TRUE, message=FALSE, warning=FALSE, include=FALSE}
devtools::install_github("bAIo-lab/muvis", dependencies=F)
library(muvis)
```

```{r include=FALSE}
library(dplyr)
library(kableExtra)
```

# NHANES Dataset

## Dateset
We'll use National Health and Nutrition Examination Survey (NHANES), 2005-2006 dataset to work with `muvis`. The original dataset contains more than 7,000 variables and nearly 10,000 samples which we selected 4461 samples and 161 variables, including Id variable ("SEQN"), continuous (i.e., laboratory measurements), and categorical variables (i.e., questions). For more details about variable names and samples visit website- <https://www.icpsr.umich.edu/icpsrweb/ICPSR/studies/25504/summary>

```{r dataset}
nhanes_data <- read.csv("../data/data.csv")
nhanes_data$SEQN <- NULL
kableExtra::kable(head(nhanes_data)) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```

## data.preproc
The dataset has some missing values. We'll use `data.preproc` to impute missing values and to specify categorical and continuous variables (Setting level = 15). The first 74 columns are continuous.
```{r preprocess}
data <- data.preproc(nhanes_data, levels = 15)
kableExtra::kable(head(data)) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```

<!-- ## dim.reduce -->
<!-- Use `dim.reduce` to visualize the continuous variables in 2 dimensions with tsne.  -->
<!-- ```{r dim, echo=TRUE, message=FALSE, warning=FALSE, eval=FALSE} -->
<!-- dim.reduce(data[,1:63], method = "tsne") -> plt -->
<!-- #plt -->
<!-- ``` -->

## ggm
Use `ggm` to construct a Gaussian Graphical Model with glasso and significance test method.
```{r ggm, echo=TRUE, message=FALSE, warning=FALSE}
ggm(data[,1:74], significance = 0.05, rho = 0.1, community = TRUE, methods = c("glasso", "sin"), plot = F) -> g
g$network
g$betweenness
g$communities
```

<!-- ## bn -->
<!-- Use `bn` to learn the structure of a Bayesian network fitting data. -->
<!-- ```{r bn, echo=TRUE, message=FALSE, warning=FALSE, eval=FALSE} -->
<!-- b <- bn(data = data[,1:63]) -->
<!-- b$network -->
<!-- b$betweenness -->
<!-- b$communities -->
<!-- ``` -->

## min.forest
Employ `min.forest` with BIC to construct a mixed-interaction model fitting the data.
```{r mf, echo=TRUE, message=FALSE, warning=FALSE}
mf <- min.forest(data, stat = "BIC", community = T, plot = F)
mf$network
mf$betweenness
```

## graph.vis
Use `graph.vis` to find communities of an arbitrary graph object and plot them. (The graph "mf$graph" here is the one resulted by `minforest` function)
```{r graph_vis, echo=TRUE, message=FALSE, warning=FALSE}
mf.val <- graph.vis(g$graph, plot = T, plot_community = T)
mf.val$communities
```
## violating.vars
Use `violating.vars` to find the most deferentially variables between people with relatively high Total Cholesterol (relative to vitamin E) and people with high Vitamin E (relative to Total Cholesterol).
"LBXTC" is Total Cholesterol and "LBXVIE" is Vitamin E. Here we use the function to find just the categorical variables.
"DSD010" is a questions about Dietary Supplements.

```{r div2, echo=TRUE, message=FALSE, warning=FALSE}
edges <- mf$network$x$edges
edges[edges$from == "LBXTC" | edges$to == "LBXTC", ]
plot.assoc(data, vars = c("LBXTC", "LBXVIE"))
violating.vars(data[75:dim(data)[2]], var1 = data$LBXTC, var2 = data$LBXVIE, permute = 100, levels = 15) -> KL
KL$name <- row.names(KL)
kableExtra::kable(head(KL, n = 20)) %>%
  kable_styling() %>%
  scroll_box(width = "300px", height = "400px")
```


## plot.assoc
Use `plot.assoc` for different visualizations. 
`levels` is set to 15 to capture categorical variables.

Histogram for PAD600 Question (About number of hours use computer last month. 0: less than hour, 1: one hour, ..., 5: five hour, 6: None):
```{r plot1, echo=TRUE, message=FALSE, warning=FALSE}
plot.assoc(data, vars = c("PAD600"), levels = 15)
```

Density plot for BMXBMI (BMI):
```{r plot2, echo=TRUE, message=FALSE, warning=FALSE}
plot.assoc(data, vars = c("RIDAGEYR"), levels = 15)
```

Boxplot of LBXTHG (Mercury amount in the blood) for different answers of DRD360 (Fish eaten during past 30 days. 1: Yes, 2: No, 3: Refused, 4: Don't know):
```{r plot3, echo=TRUE, message=FALSE, warning=FALSE}
plot.assoc(data, vars = c("LBXTHG", "DRD360"), levels = 15)
```

Relative histogram of DIQ010 (Having diabetes) vs PAD590 (Number of hours watch TV or Video last month. 1: less than hour, 2: one hour, ..., 6: five or more. 7: None, 8: Don't know):
```{r plot4, echo=TRUE, message=FALSE, warning=FALSE}
plot.assoc(data, vars = c("DIQ010", "PAD590"), levels = 15)
```

Scatter plot of BMXBMI (BMI) vs PEASCTM1 (Blood Pressure Time in seconds):
```{r plot5, echo=TRUE, message=FALSE, warning=FALSE}
plot.assoc(data, vars = c("BMXBMI", "PEASCTM1"), levels = 15)
```

Pie chart of PAD590 Question (About number of hours watch TV or Video last month. 1: less than hour, 2: one hour, ..., 6: five or more. 7: None, 8: Don't know):
```{r plot6, echo=TRUE, warning=FALSE}
plot.assoc(data, vars = c("PAD590"), levels = 15, pie = TRUE)
```



